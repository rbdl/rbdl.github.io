<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rigid Body Dynamics Library: TorqueMuscleFittingToolkit Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Rigid Body Dynamics Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d2/dc4/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_torque_muscle_fitting_toolkit.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">TorqueMuscleFittingToolkit Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:aeb09670c7aff184e4018267c7762b448"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc4/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_torque_muscle_fitting_toolkit.html#aeb09670c7aff184e4018267c7762b448">fitTorqueMuscleParameters</a> (<a class="el" href="../../d1/d37/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_millard2016_torque_muscle.html">Millard2016TorqueMuscle</a> const &amp;tqMcl, <a class="el" href="../../d2/da0/namespace_rigid_body_dynamics_1_1_math.html#a2cf580002219c9abf187ceb3d4021785">RigidBodyDynamics::Math::VectorNd</a> const &amp;jointAngle, <a class="el" href="../../d2/da0/namespace_rigid_body_dynamics_1_1_math.html#a2cf580002219c9abf187ceb3d4021785">RigidBodyDynamics::Math::VectorNd</a> const &amp;jointAngularVelocity, <a class="el" href="../../d2/da0/namespace_rigid_body_dynamics_1_1_math.html#a2cf580002219c9abf187ceb3d4021785">RigidBodyDynamics::Math::VectorNd</a> const &amp;jointTorque, double activationUpperBound, double passiveTorqueAngleMultiplierUpperBound, <a class="el" href="../../d0/daa/struct_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_torque_muscle_parameter_fitting_data.html">TorqueMuscleParameterFittingData</a> &amp;parametersOfBestFit, bool verbose=false)</td></tr>
<tr class="memdesc:aeb09670c7aff184e4018267c7762b448"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function will adjust the parameters of the muscle-torque-generator (MTG) so that the MTG is strong enough and flexible enough that it can produce the measured output torque across the vector of measured joint angles and angular velocities without exceeding the desired activation upper bound, nor the passive forces exceeding the prescribed upper bound. This function requires that IPOPT is installed and that cmake has been correctly configured to point at IPOPT's install directory. For a detailed description of the method please see : M.Millard, A.L.Kleesattel, M.Harant, &amp; K.Mombaur. A reduced muscle model and planar musculoskeletal model fit for the synthesis of whole body movements. Journal of Biomechanics. (under review as of August 2018)  <a href="#aeb09670c7aff184e4018267c7762b448">More...</a><br /></td></tr>
<tr class="separator:aeb09670c7aff184e4018267c7762b448"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="../../df/de6/_torque_muscle_fitting_toolkit_8h_source.html#l00015">15</a> of file <a class="el" href="../../df/de6/_torque_muscle_fitting_toolkit_8h_source.html">TorqueMuscleFittingToolkit.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="aeb09670c7aff184e4018267c7762b448"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb09670c7aff184e4018267c7762b448">&#9670;&nbsp;</a></span>fitTorqueMuscleParameters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fitTorqueMuscleParameters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d1/d37/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_millard2016_torque_muscle.html">Millard2016TorqueMuscle</a> const &amp;&#160;</td>
          <td class="paramname"><em>tqMcl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/da0/namespace_rigid_body_dynamics_1_1_math.html#a2cf580002219c9abf187ceb3d4021785">RigidBodyDynamics::Math::VectorNd</a> const &amp;&#160;</td>
          <td class="paramname"><em>jointAngle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/da0/namespace_rigid_body_dynamics_1_1_math.html#a2cf580002219c9abf187ceb3d4021785">RigidBodyDynamics::Math::VectorNd</a> const &amp;&#160;</td>
          <td class="paramname"><em>jointAngularVelocity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/da0/namespace_rigid_body_dynamics_1_1_math.html#a2cf580002219c9abf187ceb3d4021785">RigidBodyDynamics::Math::VectorNd</a> const &amp;&#160;</td>
          <td class="paramname"><em>jointTorque</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>activationUpperBound</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>passiveTorqueAngleMultiplierUpperBound</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/daa/struct_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_torque_muscle_parameter_fitting_data.html">TorqueMuscleParameterFittingData</a> &amp;&#160;</td>
          <td class="paramname"><em>parametersOfBestFit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>verbose</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function will adjust the parameters of the muscle-torque-generator (MTG) so that the MTG is strong enough and flexible enough that it can produce the measured output torque across the vector of measured joint angles and angular velocities without exceeding the desired activation upper bound, nor the passive forces exceeding the prescribed upper bound. This function requires that IPOPT is installed and that cmake has been correctly configured to point at IPOPT's install directory. For a detailed description of the method please see : M.Millard, A.L.Kleesattel, M.Harant, &amp; K.Mombaur. A reduced muscle model and planar musculoskeletal model fit for the synthesis of whole body movements. Journal of Biomechanics. (under review as of August 2018) </p>
<p>The method adjusts five parameters:</p>
<ol type="1">
<li><img class="formulaInl" alt="$s^A$" src="../../form_140.png"/>: the scale of the domain (angle) of the active-torque-angle-curve. This scaling is applied so that the angle which corresponds to the peak value of the active-torque-angle-curve remains unchanged.</li>
<li><img class="formulaInl" alt="$s^V$" src="../../form_141.png"/>: the scaling applied to the maximum angular velocity at which the concentric side of the torque-angular-velocity curve goes to zero.</li>
<li><img class="formulaInl" alt="$\lambda^P$" src="../../form_127.png"/>: the passive-torque-angle-blending-variable</li>
<li><img class="formulaInl" alt="$\Delta^P$" src="../../form_123.png"/>: the passive-torque-angle-offset</li>
<li><img class="formulaInl" alt="$s^\tau$" src="../../form_142.png"/>: the scaling applied to <img class="formulaInl" alt="$\tau_{o}$" src="../../form_143.png"/> the maximum active isometric torque</li>
</ol>
<p>These 5 parameters are a subset of the fitting variables that are available, and are illustrated below:</p>
<div class="image">
<img src="../../fig_MuscleAddon_BlendableTorqueMuscle.png" alt="fig_MuscleAddon_BlendableTorqueMuscle.png"/>
<div class="caption">
Examples of the adjustable characteristic curves</div></div>
<p>To peform the fitting, the user must provide vectors of the joint angle, joint angular velocity, and the joint torque for the joint that the muscle-torque-generator (MTG) actuates. The sign of all of these quantities must be consistent with the multibody and the torque muscle. IPOPT solves for the fitting parameters <img class="formulaInl" alt="$\mathbf{x}$" src="../../form_144.png"/> such that the final result is as close as possible to the values the MTG has before the fitting is performed <img class="formulaInl" alt="$\mathbf{x}_o$" src="../../form_145.png"/> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ (\mathbf{x}-\mathbf{x}_o)^T \mathbf{K} (\mathbf{x}-\mathbf{x}_o) \]" src="../../form_146.png"/>
</p>
<p> such that at every point <img class="formulaInl" alt="$i$" src="../../form_85.png"/> in the vector of joint angles, velocities, and torques the following constraints are satisfied </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tau^M(a^{max},\theta_i,\dot{\theta}_i,\mathbf{x})-\tau_i \ge 0 \]" src="../../form_147.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tau^M(0,\theta_i,\dot{\theta}_i,\mathbf{x})-\tau_i \le 0 \]" src="../../form_148.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mathbf{t}_{P}(\theta_i) - \mathbf{t}_{P}^{max} \le 0 \]" src="../../form_149.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ s^A, s^V, s^{\tau} \ge 1 \]" src="../../form_150.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ 1 \ge \lambda^P \ge 0 \]" src="../../form_151.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \pi/2 \ge \Delta^P \ge -\pi/2. \]" src="../../form_152.png"/>
</p>
<p> These constraints ensure that the muscle can deliver the requested torque with an activation of <img class="formulaInl" alt="$a^{max}$" src="../../form_153.png"/> or less, such that the active forces of the muscle are never fighting the passive forces, and that passive forces that are <img class="formulaInl" alt="$\mathbf{t}_{P}^{max}$" src="../../form_154.png"/> or less. The bound limits on the various optimization variables ensure that the muscle is not made to be weaker or slower than the default settings for the muscle. Thus if your subject is weaker than the default settings for the muscle, you should first weaken the MTG and then run this function.</p>
<p><b>Notes</b></p><ol type="1">
<li>This routine will return the parameters that fit the data, even if they are unreasonable: it is your responsibility to have a look at this data to sanity check it before using it.</li>
<li>This function will <b>not</b> update the internal parameters of the model - it just calculates what they need to be and returns them in the TorqueMuscleParametersFittingData structure. If you decide that these parameters are parameters are suitable, then they can be assigned to the model using the function <a class="el" href="../../d1/d37/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_millard2016_torque_muscle.html#ab7c62b069831e8123a1a0dbb565b9f21">Millard2016TorqueMuscle.setFittedParameters</a>. The solve and set functions have been deliberately split up to reflect the inherentely iterative, and interactive nature of fitting the strength of a musculoskeletal model to data.</li>
<li>Before attempting to fit the strength of the muscles to experimental data we recommend that you pre-process the data first. Normally this involves filtering the joint angles using a zero-phase 2nd order low-pass Butterworth filter with a cutoff frequency of 8-10 Hz (for human data). This can be achieved in Matlab using the functions 'butter' and 'filtfilt'. Following this filtering step joint angular velocities can be safely calculated numerically using a central-difference method. If you fail to filter measured joint angles it is likely that the joint angular velocities you calculate will be noisy and will result in a terrible fit. This function is not magic, and so the rule garbage in, garbage out applies.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tqMcl</td><td>The <a class="el" href="../../d1/d37/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_millard2016_torque_muscle.html" title="This class implements a rigid-tendon muscle-torque-generator (MTG) for a growing list of joints and t...">Millard2016TorqueMuscle</a> object that is to be fitted. </td></tr>
    <tr><td class="paramname">jointAngle</td><td>(radians) A vector of measured joint angles. The sign of this vector must be consistent with the multibody model and this torque muscle. </td></tr>
    <tr><td class="paramname">jointAngularVelocity</td><td>(radians/s) A vector of joint angular velocities. The sign of this vector must be consistent with the multibody model and this torque muscle. </td></tr>
    <tr><td class="paramname">jointTorque</td><td>(Nm) A vector of joint torques. Only the values in this vector that have the same torque sign as the muscle are considered during the fitting process. This means, inherently, that the muscle fitting is done assuming that there is no co-contraction. If you want co-contraction to be included in the fitting process, you must preprocess this vector so that it just contains the (estimated) single-signed torque of the muscle in question. The sign of this vector must be consistent with the multibody model and this torque muscle. </td></tr>
    <tr><td class="paramname">activationUpperBound</td><td>(0,1] The maximum activation that is permitted for the given set of joint angles, joint angular velocities, and joint torques. </td></tr>
    <tr><td class="paramname">passiveTorqueAngleMultiplierUpperBound</td><td>(0, <img class="formulaInl" alt="$\infty$" src="../../form_155.png"/>] The maximum passive torque angle multipler that you expect to see when the muscle moves through the values in jointAngle. Note that a value of 1 is quite large: this corresponds to 1 maximum active isometric torque. </td></tr>
    <tr><td class="paramname">parametersOfBestFit</td><td>A structure that contains the parameters of best fit along with a summary of the internal variables of the muscle model at the points in the data where the peak passive forces are developed and where the maximum activation is developed. </td></tr>
    <tr><td class="paramname">verbose</td><td>Setting this to will print information from IPOPT to the screen during the solution process. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>addons/muscle/<a class="el" href="../../df/de6/_torque_muscle_fitting_toolkit_8h_source.html">TorqueMuscleFittingToolkit.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dd/d16/namespace_rigid_body_dynamics.html">RigidBodyDynamics</a></li><li class="navelem"><a class="el" href="../../d6/db6/namespace_rigid_body_dynamics_1_1_addons.html">Addons</a></li><li class="navelem"><a class="el" href="../../dd/d32/namespace_rigid_body_dynamics_1_1_addons_1_1_muscle.html">Muscle</a></li><li class="navelem"><a class="el" href="../../d2/dc4/class_rigid_body_dynamics_1_1_addons_1_1_muscle_1_1_torque_muscle_fitting_toolkit.html">TorqueMuscleFittingToolkit</a></li>
    <li class="footer">Generated on Sun Sep 27 2020 14:07:31 for Rigid Body Dynamics Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
